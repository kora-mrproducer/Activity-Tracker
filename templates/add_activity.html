{% extends "layout.html" %}

{% block title %}Add Activity - Activity Tracker{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="mb-8">
        <h2 class="text-3xl font-bold text-white mb-2">
            {% if clone_source %}Clone Activity{% else %}Add New Activity{% endif %}
        </h2>
        <p class="text-secondary">
            {% if clone_source %}Creating a copy of: {{ clone_source.activity_desc[:50] }}...{% else %}Track a new task or project{% endif %}
        </p>
    </div>
    
    <div class="glass rounded-lg shadow-xl p-8">
        <form action="{{ url_for('activities.add_activity') }}" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <!-- Activity Description -->
            <div class="mb-6">
                <label for="activity_desc" class="block text-sm font-semibold text-white mb-2">
                    Activity Description <span class="text-red-400">*</span>
                </label>
                <textarea id="activity_desc" name="activity_desc" rows="4" required
                          class="w-full px-4 py-3 bg-dark-secondary border border-dark rounded-lg text-white focus:outline-none transition"
                          placeholder="Describe the activity in detail...">{% if clone_source %}{{ clone_source.activity_desc }}{% endif %}</textarea>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <!-- Source -->
                <div>
                    <label for="source" class="block text-sm font-semibold text-white mb-2">
                        Source
                    </label>
                    <input type="text" id="source" name="source" value="{% if clone_source %}{{ clone_source.source }}{% endif %}"
                           class="w-full px-4 py-3 bg-dark-secondary border border-dark rounded-lg text-white focus:outline-none transition"
                           placeholder="e.g., BUM, BUT/DCRA, Internal...">
                </div>
                
                <!-- Priority -->
                <div>
                    <label for="priority" class="block text-sm font-semibold text-white mb-2">
                        Priority <span class="text-red-400">*</span>
                    </label>
                    <select id="priority" name="priority" required
                            class="w-full px-4 py-3 bg-dark-secondary border border-dark rounded-lg text-white focus:outline-none transition">
                        <option value="Low">Low</option>
                        <option value="Medium" selected>Medium</option>
                        <option value="High">High</option>
                    </select>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <!-- Start Date -->
                <div>
                    <label for="start_date" class="block text-sm font-semibold text-white mb-2">
                        Start Date <span class="text-red-400">*</span>
                    </label>
                    <input type="date" id="start_date" name="start_date" required
                           class="w-full px-4 py-3 bg-dark-secondary border border-dark rounded-lg text-white focus:outline-none transition">
                </div>
                
                <!-- End Date -->
                <div>
                    <label for="end_date" class="block text-sm font-semibold text-white mb-2">
                        End Date <span class="text-secondary">(Optional)</span>
                    </label>
                    <input type="date" id="end_date" name="end_date"
                           class="w-full px-4 py-3 bg-dark-secondary border border-dark rounded-lg text-white focus:outline-none transition">
                </div>
            </div>
            
            <!-- Status -->
            <div class="mb-6">
                <label for="status" class="block text-sm font-semibold text-white mb-2">
                    Status
                </label>
                <select id="status" name="status"
                        class="w-full px-4 py-3 bg-dark-secondary border border-dark rounded-lg text-white focus:outline-none transition">
                    <option value="Ongoing" selected>Ongoing</option>
                    <option value="Closed">Closed</option>
                    <option value="NA">N/A</option>
                </select>
            </div>
            
            <!-- Blocking Points -->
            <div class="mb-6">
                <label for="blocking_points" class="block text-sm font-semibold text-white mb-2">
                    Blocking Points
                </label>
                <textarea id="blocking_points" name="blocking_points" rows="3"
                          class="w-full px-4 py-3 bg-dark-secondary border border-dark rounded-lg text-white focus:outline-none transition"
                          placeholder="Any obstacles or blockers..."></textarea>
            </div>
            
            <!-- Observations -->
            <div class="mb-6">
                <label for="observations" class="block text-sm font-semibold text-white mb-2">
                    Observations
                </label>
                <textarea id="observations" name="observations" rows="3"
                          class="w-full px-4 py-3 bg-dark-secondary border border-dark rounded-lg text-white focus:outline-none transition"
                          placeholder="Notes, updates, or observations..."></textarea>
            </div>
            
            <!-- Tags -->
            <div class="mb-8">
                <label for="tags" class="block text-sm font-semibold text-white mb-2">
                    Tags <span class="text-secondary">(comma-separated)</span>
                </label>
                <input type="text" id="tags" name="tags"
                       class="w-full px-4 py-3 bg-dark-secondary border border-dark rounded-lg text-white focus:outline-none transition"
                       placeholder="e.g., project-alpha, bugfix, urgent">
                <p class="text-sm text-secondary mt-2">Separate multiple tags with commas</p>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex gap-4">
                <button type="submit" 
                        class="flex-1 btn-black font-semibold py-3 px-6 rounded-lg transition flex items-center justify-center">
                    <i class="fas fa-save mr-2"></i>
                    Save Activity
                </button>
                <a href="{{ url_for('activities.dashboard') }}" 
                   class="flex-1 bg-dark-secondary hover:bg-dark-hover border border-dark text-secondary font-semibold py-3 px-6 rounded-lg transition flex items-center justify-center">
                    <i class="fas fa-times mr-2"></i>
                    Cancel
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Set today's date as default for start_date
document.getElementById('start_date').valueAsDate = new Date();

// Form validation
document.querySelector('form').addEventListener('submit', function(e) {
    const startDate = document.getElementById('start_date').value;
    const endDate = document.getElementById('end_date').value;
    const desc = document.getElementById('activity_desc').value.trim();
    
    if (!desc) {
        e.preventDefault();
        if (typeof showToast === 'function') showToast('Activity description is required', 'error');
        return false;
    }
    
    if (endDate && startDate && new Date(endDate) < new Date(startDate)) {
        e.preventDefault();
        if (typeof showToast === 'function') showToast('End date cannot be before start date', 'error');
        return false;
    }
});
</script>
{% endblock %}
